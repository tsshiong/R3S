<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <title>R3S Employee Information</title>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <style>
      body {
        font-size: .875rem;
      }
      :root {
        --colour1: #00B4D8;
        --colour2: #00313b;
      }
      .sidebar {
        position: fixed;
        top: 0;
        background: var(--colour1);
        /* rtl:raw:
        right: 0;
        */
        bottom: 0;
        /* rtl:remove */
        left: 0;
        z-index: 100; /* Behind the navbar */
        padding: 48px 0 0; /* Height of navbar */
        box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
      }
      .navbar {
        justify-content: flex-start;
      }
      img {
            width: 120px;
            height: 50px;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
      @media (max-width: 1000px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }

        .active {
          border-radius: 10px 10px 10px 10px;
        }
      }

      .sidebar-sticky {
        position: relative;
        top: 0;
        height: calc(100vh - 48px);
        padding-top: .5rem;
        overflow-x: hidden;
        overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */
      }

      .sidebar .nav-link {
        font-weight: 500;
        color: #333;
      }

      .sidebar .nav-link.active {
        color: #2470dc;
      }

      .navbar .navbar-toggler {
        right: 2.75rem;
      }
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }
      .side1 {
            width: 17.5%;
      }
	    .ex {
          margin-left: 50px;
          position: absolute;
          right: 10px;
          margin-top: auto;
          margin-bottom: auto;
      }
      ul {
        list-style-type: none;
        margin-top: 5px;
        padding: 0;
      }
      li a{
          color: var(--colour2);
          padding: 15px;
          display: flex;
          margin-left: 1.0rem;
          font-size: 1.0rem;
      }
      ul li a.active {
          background-color: white;
          border-radius: 10px 0 0 10px;
      }
      .lia1 {
          margin-right: 1.0rem;
          line-height: 25px !important;
      }
      h1 {
        left: 0;
      }
      .color {
            color: var(--colour2);
      }
      .display1 {
          display: flex;
          align-items: center;
          justify-content: flex-start;
      }
      .filter-container {
        display: flex;
      }
      .top2 {
          margin-top: 25px;
      }
      .rightspace {
          margin-right: 10px;
      }
    </style>
  </head>
<body>
    
<header class="navbar navbar-white sticky-top bg-white p-0 shadow align-self-center">
  <aside class="side1">
    <a href="Dashboard.html"><img src="../../assets/R3S logo.png" alt="R3S"></a>
  </aside>
  <h1>Employee Information</h1>
  <a href="../Logout.html" class="ex"  id="logoutButton">
      <span class="fas fa-sign-out-alt fa-2x color"></span>
  </a>
  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>
</header>

<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-blue sidebar collapse">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="Dashboard.html">
              <span class="fas fa-chart-line lia1"></span>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Restaurant.html">
              <span class="fas fa-utensils lia1"></span>
                Restaurant
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="Employee.html">
              <span class="far fa-user lia1"></span>
              Employee
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="ScheduleDaily.html">
              <span class="far fa-calendar lia1"></span>
              Schedule
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Account.html">
              <span class="far fa-user-circle lia1"></span>
              Account
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Import.html">
              <span class="fas fa-file-import lia1"></span>
              Import
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 top2">
      <div id="alert-container"></div>
        <div>
          <table id="employee-table" class="display table table-striped" style="width:100%">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>Employee Name</th>
                    <th>Position</th>
                    <th>Hire Date</th>
                    <th>Employee Type</th>
                    <th>Restaurant Name</th>
                    <th>Edit</th>
                    <th></th>
                </tr>
            </thead>
        </div>

        <!-- Delete Modal -->
        <div class="modal fade" id="staticBackdropDeleteEmployee" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
              <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">Delete Employee(s)</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body" id="checkbox-count">
              
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-danger" id="confirm_delete">Confirm</button>
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
          </div>
          </div>
        </div>

        <!-- Delete success Modal -->
        <div class="modal fade" id="deleteEmpSuccessModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
              <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">Delete Successfully</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="delempsuccess1"></button>
              </div>
              <div class="modal-body" id="checkbox-count1">
                  The employee(s) has/have been deleted successfully!
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="delempsuccess2">Close</button>
              </div>
          </div>
          </div>
        </div>

        <!-- Delete fail Modal -->
        <div class="modal fade" id="deleteEmpErrorModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
              <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">Delete Failed</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body" id="checkbox-count2">
                  Deletion of the employee(s) has/have failed!
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
          </div>
          </div>
        </div>

        <!-- Edit Modal -->
        <div class="modal fade" id="staticBackdropEditEmployee" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content">
              <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">Edit Employee</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                  <form id="edit-form">
                      <input class="form-control" type="hidden" name="Employee_id" id="edit-empid">
                    <div class="form-group">
                      <label for="employee_name">Employee Name</label>
                      <input class="form-control" type="text" name="employee_name" id="edit-empname">
                    </div>
                    <div class="form-group">
                      <label for="employee_position">Position</label>
                      <select class="form-control" id="edit-employee-position" name="position" required>
                        <option value="" selected disabled>Select a position</option>
                        <option value="Service">Service</option>
                        <option value="Kitchen">Kitchen</option>
                        <option value="Manager">Manager</option>
                      </select>
                    </div>                    
                    <div class="form-group">
                      <label for="employee_hiredate">Hire Date</label>
                      <input class="form-control" type="date" name="employee_hiredate" id="edit-hiredate">
                    </div>
                    <div class="form-group">
                      <label for="employee_type">Employee Type</label>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input mr-2" type="radio" name="employeeType" value="Full Time" id="edit-full" required>
                        <label class="form-check-label mr-4">Full Time</label>
                      </div>
                      <div class="form-check form-check-inline">
                          <input class="form-check-input mr-2" type="radio" name="employeeType" value="Part Time" id="edit-part" required>
                          <label class="form-check-label mr-4">Part Time</label>
                      </div>
                    </div>
                    <input type="hidden" name="restaurant_id" id="edit-resid" value="{{employee.restaurant.id}}">
                    <div class="form-group">
                      <label for="employee_resname">Restaurant Name</label>
                      <select class="form-control" name="employee_resname" id="edit-resname" required>
                        <option value="" selected disabled>Select a restaurant</option>
                      </select>
                    </div>                    
                </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-primary" id="updateempbtn">Save</button>
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
          </div>
          </div>
        </div>

        <!-- update success Modal -->
        <div class="modal fade" id="updatesuccessModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
              <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">Edit Successfully</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="updatesuccess1"></button>
              </div>
              <div class="modal-body" id="checkbox-count1">
                  The employee details has been edited successfully!
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="updatesuccess2">Close</button>
              </div>
          </div>
          </div>
        </div>

        <!-- update fail Modal -->
        <div class="modal fade" id="updatefailModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Update Failed</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="checkbox-count2">
                The employee details update failed!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
        </div>
        </div>

        <!-- Add Modal -->
        <div class="modal fade" id="staticBackdropAddEmployee" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content">
              <div class="modal-header">
              <h5 class="modal-title" id="staticBackdropLabel">Add New Employee</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="addemp-form">
                  <input class="form-control" type="hidden" name="Employee_id" id="add-empid">
                <div class="form-group">
                  <label for="employee_name">Employee Name</label>
                  <input class="form-control" type="text" name="employee_name" id="add-empname" required>
                </div>
                <div class="form-group">
                  <label for="employee_position">Position</label>
                  <select class="form-control" id="add-employee-position" name="position" required>
                    <option value="" selected disabled>Select a position</option>
                    <option value="Service">Service</option>
                    <option value="Kitchen">Kitchen</option>
                    <option value="Manager">Manager</option>
                  </select>
                </div>                    
                <div class="form-group">
                  <label for="employee_hiredate">Hire Date</label>
                  <input class="form-control" type="date" name="employee_hiredate" id="add-hiredate">
                </div>
                <div class="form-group">
                  <label for="employee_type">Employee Type</label>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input mr-2" type="radio" name="employeeType" value="Full Time" id="add-full" required>
                    <label class="form-check-label mr-4">Full Time</label>
                  </div>
                  <div class="form-check form-check-inline">
                      <input class="form-check-input mr-2" type="radio" name="employeeType" value="Part Time" id="add-part" required>
                      <label class="form-check-label mr-4">Part Time</label>
                  </div>
                </div>
                <div class="form-group">
                  <label for="employee_resname">Restaurant Name</label>
                  <select class="form-control" name="employee_resname" id="add-resname" required>
                    <option value="" selected disabled>Select a restaurant</option>
                  </select>
                </div>                    
              </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-primary" id="addnewemp">Add</button>
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
          </div>
          </div>
        </div>

        <!-- add success Modal -->
        <div class="modal fade" id="addsuccessModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Add Successfully</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="addsuccess1"></button>
            </div>
            <div class="modal-body" id="checkbox-count1">
                The employee details has been added successfully!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="addsuccess2">Close</button>
            </div>
        </div>
        </div>
        </div>

        <!--add fail Modal -->
        <div class="modal fade" id="addfailModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Add New Employee Failed</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="checkbox-count2">
                The employee details was not successfully added!
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
        </div>
        </div>


    </main>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<script>

$(document).ready(function () {
  var accountId;
  $.ajax({
        type: "GET",
        url: "http://localhost:8082/get-session",
        xhrFields: {
            withCredentials: true
        },
        success: function(response) {
            accountId = response;

            // Use the retrieved session data as needed
            console.log('Account ID:', accountId);
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error('Failed to retrieve session data:', errorThrown);
            window.location.href = '../index1.html';
        }
    });
    

    $('#logoutButton').click(function() {
        // Send AJAX request to the backend logout endpoint
        $.ajax({
            type: 'POST',
            url: 'http://localhost:8082/logout', // Replace with your actual backend logout endpoint URL
            xhrFields: {
                withCredentials: true // Include cookies in the request
            },
            success: function(response) {
                window.location.href = '../Logout.html'; // Redirect to the logout.html page
            },
            error: function(jqXHR, textStatus, errorThrown) {
                // Handle error
                alert('Logout failed: ' + jqXHR.responseText);
            }
        });
    });

    var dataTable = $('#employee-table').DataTable({
        serverSide: true,
        processing: true,
        order:[[0,'asc']],
        ajax: {
            url: 'http://localhost:8082/employee/employee-table',
            type: 'GET',
            //retrieve values of dataTable
            data: function (d) {
                d.page = $('#employee-table').DataTable().page.info().page;
                d.size = $('#employee-table').DataTable().page.info().length;
                d.sortColumn = $('#employee-table').DataTable().order()[0][0];
                console.log(d.sortColumn)
                if (d.sortColumn === 1) {
                    d.sortColumn = 'employeeName';
                } else if (d.sortColumn === 5) {
                    d.sortColumn = 'restaurantName';
                } else if (d.sortColumn === 3) {
                    d.sortColumn = 'hireDate';
                } else {
                    d.sortColumn = 'employeeId';
                }
                
                d.sortDirection = $('#employee-table').DataTable().order()[0][1];
                d["search"] = $('#employee-table_filter input').val();
                d.position = $('#position-filter').val();
                d.employeeType = $('#employeeType-filter').val();
                d.draw = $('#employee-table').DataTable().page.info().draw;
            },
            dataSrc: function (json) {
                return json.employees;
            },
            dataType: "json"
        },
        columns: [
            { data: 'employeeId', searching: true, orderable: true},
            { data: 'employeeName', searching: true, orderable: true },
            { data: 'position', orderable: false },
            { data: 'hireDate', orderable: true },
            { data: 'employeeType', orderable: false },
            { data: 'restaurantName', searching: true, orderable: true },
            {
              data: null,
              orderable: false,
              searchable: false,
              render: function (data, type, row, meta) {
                  return '<button type="button" class="btn btn-primary btn-sm editemprowbtn" data-bs-toggle="modal" data-bs-target="#staticBackdropEditEmployee" id="editemployee">Edit</button>';
              },
            },
            {
              data: null,
              orderable: false,
              searchable: false,
              className: 'dt-center',
              render: function (data, type, row, meta) {
              return '<input type="checkbox" class="row-checkbox" value="' + row.id + '">';
              },
              title: '<input type="checkbox" id="select-all">'
            }
            
        ],
        language: {
            infoEmpty: "Showing 0 to 0 of 0 entries",
            zeroRecords: "No matching records found",
            search: "Search:"
        },
        drawCallback: function (settings) {
            updateDeleteBtn();
            var api = this.api();
            console.log(api.page.info())
            var pageInfo = api.page.info();
            var start = pageInfo.start + 1;
            var end = start + api.page.len() - 1;
            var total = api.page.info().recordsDisplay;
            $('#employee-table_info').html("Showing " + start + " to " + end + " of " + total + " entries");
            $('#select-all').prop('checked', false);
            $('.row-checkbox').prop('checked', false);
        }
    });

    var filterHTML = '<label style="margin-left: 10px;">Position: <select id="position-filter" class="form-select form-select-sm rightspace">' +
    '<option selected value="">All</option>' +
    '<option value="Service">Service</option>' +
    '<option value="Kitchen">Kitchen</option>' +
    '<option value="Manager">Manager</option>' +
    '</select></label>';

    var filterHTML1 = '<label>Type: <select id="employeeType-filter" class="form-select form-select-sm rightspace">' +
    '<option selected value="">All</option>' +
    '<option value="Full Time">Full Time</option>' +
    '<option value="Part Time">Part Time</option>' +
    '</select></label>';
    
    // Add the filter dropdown to the DataTable layout
    var filterContainer = $('<div>').addClass('filter-container');
    $(filterHTML).appendTo(filterContainer);
    $(filterHTML1).appendTo(filterContainer);
    $(filterContainer).appendTo('.dataTables_length');
    $('.dataTables_length').addClass('display1');

    

    

     // Apply the filter on change of dropdown
    $('#position-filter').on('change', function() {
        var selectedValue = $(this).val();
        dataTable.column('position').search(selectedValue).draw();
        $('#select-all').prop('checked', false);
        updateDeleteBtn();
    });

    $('#employeeType-filter').on('change', function() {
        var selectedValue = $(this).val();
        dataTable.column('employeeType').search(selectedValue).draw();
        $('#select-all').prop('checked', false);
        updateDeleteBtn();
    });


    var buttonHTML3 = '<button type="button" id="addempbtn" class="btn btn-success btn-sm rightspace" data-bs-toggle="modal" data-bs-target="#staticBackdropAddEmployee" style="display: flex;"><i class="fas fa-plus"  style="margin-top: 4px; margin-right:4px;"></i>Add</button>'
    $(buttonHTML3).appendTo('.dataTables_length');

    var buttonHTML = '<button type="button" id="delempbtn" class="btn btn-danger btn-sm rightspace" data-bs-toggle="modal" data-bs-target="#staticBackdropDeleteEmployee" disabled>Delete</button>'
    $(buttonHTML).appendTo('.dataTables_length');


    function updateDeleteBtn() {
        if($('.row-checkbox:checked').length > 0) {
            $("#delempbtn").prop('disabled', false);
        } else {
            $("#delempbtn").prop('disabled', true);
        }
    }

    $(document).on('change', '.row-checkbox', function () {
        var allChecked = $('.row-checkbox').length === $('.row-checkbox:checked').length;
        $('#select-all').prop('checked', allChecked);
        updateDeleteBtn();
    });

    dataTable.on('page', function() {
        $('#select-all').prop('checked', false);
    });

    $(document).on('change', '#select-all', function () {
        $('.row-checkbox').prop('checked', $(this).prop('checked'));
        updateDeleteBtn();
    });

    $("#delempbtn").click(function() {
        var count = $('.row-checkbox:checked').length;
        $("#checkbox-count").text("Are you sure you want to permanently delete this " + count + " employee(s)? \n Once the employee(s) has been deleted, the data cannot be recovered!!!");
    });

    dataTable.on('search.dt', function() {
        $('#select-all').prop('checked', false);
    });
    
    $("#confirm_delete").click(function() {
        var employeeIds = [];
        $('.row-checkbox:checked').each(function() {
            var employeeId = $(this).closest('tr').find('td:eq(0)').text();
            employeeIds.push(employeeId);
            
        });
        console.log(employeeIds)
        // Perform an AJAX request to delete the accounts with the given IDs on the server-side
        $.ajax({
            url: 'http://localhost:8082/employee/delete-employees',
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            data: JSON.stringify(employeeIds),
            success: function(response, status, xhr) {
                if(xhr.status == 200) {
                    console.log(response)
                    $('#staticBackdropDeleteEmployee').modal('hide');
                    $('#deleteEmpSuccessModal').modal('show');
                    $("#delempsuccess1").click(function() {
                        updateDeleteBtn();
                        dataTable.ajax.reload();
                    });
                    $("#delempsuccess2").click(function() {
                        updateDeleteBtn();
                        dataTable.ajax.reload();
                    });
                }
            },
            error: function(error) {
                console.log(error)
                $('#staticBackdropDeleteEmployee').modal('hide');
                $('#deleteEmpErrorModal').modal('show');
            }
        }); 
    });
    
});


$(document).on("click", ".editemprowbtn", function() {
    var employeeId = $(this).closest('tr').find('td:eq(0)').text();

    // Populate the restaurant names select element
    $.ajax({
        url: 'http://localhost:8082/restaurant/all_restaurants',
        method: 'GET',
        success: function(response) {
          console.log(response)
            // Clear the select element
            $('#edit-resname').empty();
            // Create the default option element
            var defaultOption = $('<option>').attr('value', '').text('Select a restaurant');
            $('#edit-resname').append(defaultOption);
            // Create an option element for each restaurant name and append it to the select element
            $.each(response, function(index, restaurant) {
                var option = $('<option>').attr('value', restaurant[1]).text(restaurant[1]);
                $('#edit-resname').append(option);
            });

            // Get the employee data and populate the form fields
            $.ajax({
                url: 'http://localhost:8082/employee/getemployee/' + employeeId,
                method: 'GET',
                success: function(response) {
                    console.log(response);
                    $('#edit-empid').val(response[0]);
                    $('#edit-empname').val(response[1]);
                    $('#edit-employee-position').val(response[2]);
                    $('#edit-hiredate').val(response[3]);
                    if(response[4] == 'Full Time') {
                        $('#edit-full').prop('checked', true);
                    } else {
                        $('#edit-part').prop('checked', true);
                    }
                    $('#edit-resid').val(response[5]);
                    $('#edit-resname').find('option').each(function() {
                        if ($(this).text() === response[6]) {
                            $(this).attr('selected', true);
                        }
                    });
                },
                error: function(xhr) {
                    console.log(xhr.responseText);
                }
            });
        },
        error: function(xhr) {
            console.log(xhr.responseText);
        }
    });
});


$(document).on("click", "#updateempbtn", function() {
  var editedEmpName = $("input[name='employee_name']").val();
  var editedEmpPosition = $("#edit-employee-position").val();
  var editedEmpHireDate = $("input[name='employee_hiredate']").val();
  var editedEmpType = $("input[name='employeeType']:checked").val();
  var editedEmpResName = $("#edit-resname").val();

  // Get the employee ID from the form
  var employeeId = $("#edit-empid").val();

  // Search the restaurant ID based on the restaurant name
  $.ajax({
    type: "GET",
    url: "http://localhost:8082/restaurant/find_by_name/" + editedEmpResName,
    success: function(data) {
      // Send the updated data to the server using AJAX
      $("#edit-resid").val(data[0]);
      $.ajax({
        type: "PUT",
        url: "http://localhost:8082/employee/update_employee/" + employeeId,
        contentType: "application/json",
        data: JSON.stringify({
          "employeeName": editedEmpName,
          "position": editedEmpPosition,
          "hireDate": editedEmpHireDate,
          "employeeType": editedEmpType,
          "restaurantId": data[0] // Use the retrieved restaurant ID
        }),
        success: function() {
            $('#staticBackdropEditEmployee').modal('hide');
            $("#updatesuccessModal").modal('show');
            $("#updatesuccess1").click(function() {
              location.reload();
            });
            $("#updatesuccess2").click(function() {
              location.reload();
            });
        },
        error: function() {
          $('#staticBackdropEditEmployee').modal('hide');
          $("#updatefailModal").modal('show');
        }
      });
    },
    error: function() {
      $('#staticBackdropEditEmployee').modal('hide');
      $("#updatefailModal").modal('show');
    }
  });
});



$(document).on("click", ".btn-close", function() {
  $(this).closest('.alert').alert('close');
});

$(document).on("click", "#addnewemp", function() {
  $.ajax({
    type: "POST",
    url: "http://localhost:8082/employee/add_employee",
    contentType: "application/json",
    data: JSON.stringify({
      "employeeName": $("#add-empname").val(),
      "position": $("#add-employee-position").val(),
      "hireDate": $("#add-hiredate").val(),
      "employeeType": $("input[name='employeeType']:checked").val(),
      "restaurantId": $("#add-resname").val()
    }),
    success: function(data) {
      $('#staticBackdropAddEmployee').modal('hide');
          $("#addsuccessModal").modal('show');
          $("#addsuccess1").click(function() {
            location.reload();
            });
            $("#addsuccess2").click(function() {
              location.reload();
            });
    },
    error: function() {
      $('#staticBackdropAddEmployee').modal('hide');
          $("#addfailModal").modal('show');
    }
  });
});


$(document).on("click", ".btn-close", function() {
  $(this).closest('.alert').alert('close');
});

$(document).ready(function() {
  $.ajax({
    type: "GET",
    url: "http://localhost:8082/restaurant/all_restaurants",
    success: function(data) {
      // Populate the dropdown with the list of restaurants
      $.each(data, function(key, value) {
        $("#add-resname").append("<option value='" + value[0] + "'>" + value[1] + "</option>");
      });
    },
    error: function() {
      // Do something on error
      console.log("Error");
    }
  });
});
</script>
</body>
</html>
